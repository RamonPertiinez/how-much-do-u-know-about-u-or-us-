<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Joc 1 — Endevina la cançó</title>

  <!-- Globals si en tens -->
  <link rel="stylesheet" href="../../css/base.css">
  <!-- Estil específic del joc -->
  <link rel="stylesheet" href="game1.css">
</head>
<body>
  <header class="wrap">
    <a class="back" href="../../index.html">← Tornar</a>
    <h1>Joc 1 · Endevina la cançó</h1>
    <p class="intro">
      Escolta la pista i tria la resposta. Dura la cançó completa (sense límit de 10s).
    </p>
  </header>

  <main class="wrap">
    <section class="player">
      <audio id="audio" preload="metadata"></audio>

      <div class="controls">
        <button id="btnPlay">▶︎ Play</button>
        <button id="btnPause" disabled>⏸️ Pausa</button>
        <span id="status" class="status">Pista 1/5</span>
      </div>
    </section>

    <section class="quiz">
      <div id="options" class="options"></div>
      <p id="feedback" class="feedback"></p>
      <div class="nav">
        <button id="btnNext" class="btn" disabled>Següent</button>
        <a class="btn" href="../../index.html">Tornar al menú</a>
      </div>
    </section>
  </main>

  <script src="game1.js"></script>

  <script>
  // Opció A: si el teu joc 1 ja té un "finish", crida aquesta funció quan guanyi
  window.markGame1Done = function(){
    localStorage.setItem('game1_done','1');
    location.href='../../index.html#hub';
  };

  // Opció B: si només vols un botó "Tornar al menú" que no marqui com fet:
  // document.getElementById('btnBackToHub')?.addEventListener('click', ()=>location.href='../../index.html#hub');

  // Si es recarrega aquesta pàgina, torna al hub
  try { const n = performance.getEntriesByType?.('navigation')[0]; if (n && n.type==='reload') location.replace('../../index.html#hub'); } catch {}
  if (!localStorage.getItem('hmky.hubUnlocked')) location.replace('../../index.html#hub');
</script>

<script>
  (function hookGame1(){
    // 1) Si el joc exposa callbacks (onWin / onFail)
    if (window.GameAudioGuess && typeof window.GameAudioGuess === 'object') {
      const origWin = window.GameAudioGuess.onWin;
      window.GameAudioGuess.onWin = function(...args){
        try { localStorage.setItem('game1_done','1'); } catch {}
        if (typeof origWin === 'function') origWin.apply(this, args);
        location.href = '../../index.html#hub';
      };
      return;
    }
    // 2) Si el joc dispara un event personalitzat
    window.addEventListener('game1:finished', () => {
      try { localStorage.setItem('game1_done','1'); } catch {}
      location.href = '../../index.html#hub';
    });
    // 3) Reintent si encara no s'ha carregat el joc
    setTimeout(hookGame1, 80);
  })();

  // Si es recarrega aquesta pàgina, torna al Hub
  try {
    const nav = performance.getEntriesByType?.('navigation')[0];
    if (nav && nav.type === 'reload') location.replace('../../index.html#hub');
  } catch {}
  if (!localStorage.getItem('hmky.hubUnlocked')) location.replace('../../index.html#hub');
</script>

  
</body>
</html>
